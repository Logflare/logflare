<div class="subhead ">
  <div class="container mx-auto">

    <h5>~/endpoints/<%= link @endpoint_query.name, to: Routes.endpoints_path(@conn, :show, @endpoint_query), class: "text-primary" %></h5>

    <div class="log-settings">
      <ul>
        <li><%= link to: Routes.endpoints_path(@conn, :edit, @endpoint_query) do %><i class="fas fa-edit"></i><span class="hide-on-mobile"> edit</span> <% end %></li>
        <li><a href="mailto:support@logflare.app?Subject=Logflare%20Help" target="_top"><i class="fas fa-question-circle"></i> <span class="hide-on-mobile">help</a></span></li>
      </ul>
    </div>

  </div>
</div>
<div class="content container mx-auto">
    <%= if @endpoint_query.enable_auth == false do %>
      <p class="alert-warning px-4 py-2">
        <strong>Authentication Not Enabled!</strong> Authentication has not been enabled for this endpoint, and may pose a security risk.
      </p>
    <% end %>

    <%= section_header("Query") %>


    <code>
      <pre><%= @endpoint_query.query %></pre>
    </code>

    <%= if @endpoint_query.sandboxable do %>
      This endpoint accepts optional sandboxed query through <code>sql</code> parameter
    <% end%>

    <%= unless Enum.empty?(@parameters) do %>
      <div class="mb-4">
      <%= section_header("Parameters") %>
      <%= for parameter <- @parameters do %>
        <div>
        <label for="param[<%= parameter %>]">
        <%= parameter %>
        </label>
        <input id="param[<%= parameter %>]">
        </div>
      <% end %>
      </div>
    <% end %>

    <div class="mt-4">
      <button class="btn btn-primary" onclick="Endpoint.query('<%= @endpoint_query.token %>', collectParameters())">Run</button>
    </div>

    <div id="queryResult" class="mt-4">
    </div>

    <%= section_header("cURL Example") %>

    <code>
    <pre class="pt-2">
    curl "<%= Routes.endpoints_url(@conn, :query, @endpoint_query.token)%>" \
         -H 'X-API-KEY: YOUR-ACCESS-TOKEN' \
         -H 'Content-Type: application/json; charset=utf-8' <%= unless Enum.empty?(@parameters) do %> \
         -G <%= for parameter <- @parameters do %>-d "<%= parameter %>=VALUE" <% end%>
    <% end %>
    </pre>
    </code>

    <%= if @endpoint_query.sandboxable do %>
      <%= section_header("cURL Example for sandboxed queries") %>

      <code>
      <pre class="pt-2">
      curl "<%= Routes.endpoints_url(@conn, :query, @endpoint_query.token)%>" \
           -H 'X-API-KEY: YOUR-ACCESS-TOKEN' \
           -H 'Content-Type: application/json; charset=utf-8' <%= unless Enum.empty?(@parameters) do %> \
           -G <%= for parameter <- @parameters do %>-d "<%= parameter %>=VALUE" <% end%>
      <% end %> \
           -G -d "sql=SQL"
      </pre>
      </code>
    <% end%>


</div>

<script>
function collectParameters() {
    <%= unless Enum.empty?(@parameters) do %>
      var parameters = {}
      <%= for parameter <- @parameters do %>
      parameters["<%= parameter %>"] = document.getElementById("param[<%= parameter %>]").value
      <% end %>
      return parameters
    <% else %>
       return []
    <% end %>
}
</script>
